<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Task Manager</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>

    <div id="auth-screen" class="container">
        <h1>Task Manager</h1>
        <div class="card">
            <h2>ログイン</h2>
            <input type="text" id="login-user" placeholder="ユーザー名">
            <input type="password" id="login-pass" placeholder="パスワード">
            <button id="login-btn">ログイン</button>
        </div>
        <div class="card">
            <h2>新規登録</h2>
            <input type="text" id="reg-user" placeholder="ユーザー名">
            <input type="password" id="reg-pass" placeholder="パスワード">
            <button id="reg-btn" class="secondary">登録</button>
        </div>
        <p id="msg"></p>
    </div>

    <div id="app-screen" class="container hidden">
        <header>
            <h1>My Tasks</h1>
            <div>
                <span id="display-name"></span>
                <button id="logout-btn" class="danger">ログアウト</button>
            </div>
        </header>

        <div class="stats-bar card">
            <div class="stats-info">
                <span>全タスク: <b id="total-count">0</b></span>
                <span>完了済: <b id="completed-count">0</b></span>
            </div>
            <div class="progress-container">
                <div id="progress-fill" class="progress-fill"></div>
            </div>
        </div>

        <div class="filter-tabs">
            <button class="tab-btn active" id="filter-all" onclick="setFilter('all')">すべて</button>
            <button class="tab-btn" id="filter-pending" onclick="setFilter('pending')">未完了</button>
            <button class="tab-btn" id="filter-completed" onclick="setFilter('completed')">完了</button>
        </div>
        
        <main>
            <div class="card task-input-card">
                <input type="text" id="new-task-title" placeholder="タスク名">

                <div class="category-row-wrapper">
                    <select id="new-task-category">
                        <option value="">カテゴリなし</option>
                    </select>
                    <button type="button" onclick="openCategoryModal()" class="add-cat-btn-subtle" title="カテゴリ管理">＋</button>
                </div>
                <input type="date" id="new-task-date">

                <select id="new-task-priority">
                    <option value="low">優先度：低</option>
                    <option value="medium" selected>優先度：中</option>
                    <option value="high">優先度：高 </option>
                </select>
                
                <button id="add-task-btn">タスクを追加</button>
            </div>
            
            <ul id="task-list"></ul>
        </main>
    </div>

    <div id="edit-modal" class="modal hidden">
        <div class="modal-content card">
            <h3>タスクを編集</h3>
            <input type="hidden" id="edit-task-id">
            <input type="text" id="edit-task-title" placeholder="タスク名">
            <div class="edit-options" style="display: flex; flex-direction: column; gap: 10px; margin-top: 10px;">
                <select id="edit-task-category">
                    <option value="">カテゴリなし</option>
                </select>
                <input type="date" id="edit-task-date">
                <select id="edit-task-priority">
                    <option value="low">低</option>
                    <option value="medium">中</option>
                    <option value="high">高</option>
                </select>
            </div>
            <div class="modal-buttons">
                <button id="save-edit-btn">保存</button>
                <button onclick="closeModal()" class="secondary">キャンセル</button>
            </div>
        </div>
    </div>

    <div id="category-modal" class="modal hidden">
        <div class="modal-content card">
            <h3>カテゴリ管理</h3>
            <div style="display: flex; gap: 10px; margin-bottom: 20px;">
                <input type="text" id="new-category-name" placeholder="新しいカテゴリ名" style="flex: 1;">
                <button id="save-category-btn">追加</button>
            </div>
            <hr style="border: 0; border-top: 1px solid #eee; margin: 20px 0;">
            <h4>登録済みのカテゴリ</h4>
            <div id="category-manage-list"></div>
            <div class="modal-buttons">
                <button onclick="closeCategoryModal()" class="secondary">閉じる</button>
            </div>
        </div>
    </div>

    <script src="script.js"></script>
</body>
</html>